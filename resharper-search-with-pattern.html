<!DOCTYPE html>
<html lang="ru">
<head>
          <title>tkirill's blog</title>
        <meta charset="utf-8" />





  <link rel="stylesheet" type="text/css" href="http://tkirill.org/theme/css/pygments-friendly.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://tkirill.org">tkirill's blog <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://tkirill.org/resharper-search-with-pattern.html" rel="bookmark"
         title="Permalink to Search with Pattern в ReSharper">Search with Pattern в ReSharper</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-04-02T00:00:00">
      Wed 02 April 2014
    </abbr>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Долгое время я ждал задачи, в которой получилось бы использовать Search with Pattern -- многообещающую фичу ReSharper, которую по-русски я буду называть структурным поиском.  В этом поиске используются шаблоны, которые похожи на регулярные выражения, только работающие в грамматике C#, то есть они оперируют идентификаторами, переменными, выражениями и другими структурами языка.</p>
<p>Например, пусть раньше в тестах для сравнения строк без учёта регистра использовался StringAssert:</p>
<div class="highlight"><pre><span class="n">StringAssert</span><span class="p">.</span><span class="n">AreEqualIgnoringCase</span><span class="p">(</span><span class="s">&quot;2013.1.1&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="m">2013</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;yyyy.M.d&quot;</span><span class="p">));</span>
<span class="c1">//...</span>
<span class="n">StringAssert</span><span class="p">.</span><span class="n">AreEqualIgnoringCase</span><span class="p">(</span><span class="s">&quot;AA&quot;</span><span class="p">+</span><span class="s">&quot;bb&quot;</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Concat</span><span class="p">(</span><span class="s">&quot;aa&quot;</span><span class="p">,</span> <span class="s">&quot;BB&quot;</span><span class="p">));</span>
</pre></div>


<p>То есть, в качестве первого и второго аргументов могут передаваться произвольные выражения, а не только строковые литералы.  Теперь представим, что в проекте поменялись соглашения и теперь все проверки принято записывать через Assert.That.  Наш пример в новых соглашениях будет выглядеть так:</p>
<div class="highlight"><pre><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="m">2013</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;yyyy.M.d&quot;</span><span class="p">),</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">&quot;2013.1.1&quot;</span><span class="p">).</span><span class="n">IgnoreCase</span><span class="p">);</span>
<span class="c1">//...</span>
<span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Concat</span><span class="p">(</span><span class="s">&quot;aa&quot;</span><span class="p">,</span> <span class="s">&quot;BB&quot;</span><span class="p">),</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">&quot;AA&quot;</span> <span class="p">+</span> <span class="s">&quot;bb&quot;</span><span class="p">).</span><span class="n">IgnoreCase</span><span class="p">);</span>
</pre></div>


<p>Мы можем использовать структурный поиск для замены старого способа записи на новый.  Выбрав пункт меню ReSharper -&gt; Find -&gt; Search with Pattern и нажав в открывшемся окне на Replace в верхнем правом углу мы приступаем к написанию шаблона.</p>
<p><img alt="ReSharper Search with Pattern window" src="http://tkirill.org/images/resharper-search-with-pattern/empty-search-with-pattern.png" title="ReSharper Search with Pattern window" /></p>
<p>Шаблон для поиска:</p>
<div class="highlight"><pre>StringAssert.AreEqualIgnoringCase($expected$, $actual$);
</pre></div>


<p>Шаблон для замены:</p>
<div class="highlight"><pre>Assert.That($actual$, Is.EqualTo($expected$).IgnoreCase);
</pre></div>


<p>expected и actual обозначают аргументы, мы задаём это явно в настройках placeholder:</p>
<p><img alt="Argument constraints in ReSharper Search with Pattern" src="http://tkirill.org/images/resharper-search-with-pattern/argument-constraint.png" title="Argument constraints in ReSharper Search with Pattern" /></p>
<p>Нам остаётся нажать Replace, остальное сделает ReSharper.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
          ga('create', 'UA-49219502-1', 'tkirill.org');
          ga('send', 'pageview');
        
        </script>
</body>
</html>